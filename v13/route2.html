<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/x-icon" href="/eta/icon/icon.png">

<style>
input.busrt{
width:calc(100% - 75px); 
display: inline;
height:27px; 
font-size:18px; 
min-width:100px;
}

button.bt2{
display: inline; 
padding: 7px 16px;
background-color: #d3d3d3a0;
border-color: lightgray;
}

div.route_choose{
  position: -webkit-sticky; /* Safari */
  position: sticky;
  background-color:#b4c4ffff;
  top: 0;
  left: 0;
  right: 0;
}

</style>
<body>
<div class="route_choose">
 <input class="busrt" type="number" id="busroute">
 <button id="submit" onclick="submit();" class="bt2">搜尋</button>
</div>

<div style="background-color:#b4c4ffff" id="routetable">
<table id="P"></table>
</div>

</body>
</html> 

<script>
function httpGet(theUrl, callback)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            callback(xmlHttp.responseText);
    }
    xmlHttp.open("GET", theUrl, true); 
    xmlHttp.send(null);
}

String.prototype.replacement = function(r){return this.replace(/\{\#\d\}/g, m => r.shift() || m);}
</script>

<script>
//v5

var _rtlist={}
var ROUTES=[];
httpGet("https://raw.githubusercontent.com/996633c/eta2/data/_rtlist.json",q=>{_rtlist=JSON.parse(q);ROUTES=getRtList2()})

var INPUT_pend = [];

function getRtList2(){
var s=[];
Object.values(_rtlist.CTB).concat(Object.values(_rtlist.KMB)).forEach(w=>{
	Object.keys(w.var).forEach(e=>{
		try{s.push({"co":w.co,"r":w.route,"d":w.var[e].dest_tc,"d_en":w.var[e].dest_en,"b":e,"sf":w.co+"+"+w.route+"+"+e})}catch{}
	})
})
return s
}
  

function XXX(v) {
  var Q1 = /[A-Z][0-9]+/;
  if (Q1.exec(v))return v;
    
  var YYY = parseInt(v).toString().padStart(4, '0');
  var mmm = /[A-Z]/g;
  var nnn = mmm.exec(v);
  return YYY + (nnn ? nnn[0] : '');
}

function submit(){
while(document.getElementById("P").childNodes.length>0){document.getElementById("P").childNodes[0].remove()};

INPUT_pend = ROUTES.filter(q=>q.r.includes(document.getElementById("busroute").value));

INPUT_pend=INPUT_pend.sort((a,b)=>{return (XXX(a.r) < XXX(b.r) ? 1 :-1)});

INPUT_pend.forEach((data,i)=>{
    document.getElementById("P").insertRow(0).innerHTML = 
`<button style="text-align: left; width:100%; background-color:{#0}; border: none;" id="routename_{#1}" onclick="window.location.href = '/eta/v13/route3.html?{#3}'">
<div style="display: inline;">
<img src="/eta/icon/{#4}.png" style="width:6%;min-width:30px">
</div>
<div style="display: inline;">
<pre style="display: inline;font-size:5vw;">{#5}</pre><pre style="display: inline;font-size:3vw;">往: {#6}</pre>
</div></button>`.replacement([
	i%2==0?"#ccca":"#fffa",
	i,
	data.sf,
	data.co.toLowerCase(),
	data.r.padEnd(6," "),
	data.d
]

)


;
});
}
</script>
